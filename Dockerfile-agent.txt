# Multi-stage build para agentes (um por reposit√≥rio)
FROM python:3.12-slim AS builder
WORKDIR /app
RUN pip install uv && apt-get update && apt-get install -y git
COPY pyproject.toml .
RUN uv sync --all-extras

FROM gcr.io/distroless/python3-debian12
WORKDIR /app
COPY --from=builder /app/.venv /app/.venv
COPY services/agent/src /app/src
ENV PATH="/app/.venv/bin:$PATH"
VOLUME /workspace
CMD ["python", "src/worker.py"]